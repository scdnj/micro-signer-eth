import { deepStrictEqual, throws } from 'node:assert';
import { describe, should } from 'micro-should';
import { tokenFromSymbol } from '../lib/esm/abi/index.js';
import { FetchProvider, ENS, Chainlink, UniswapV3 } from '../lib/esm/net/index.js';
import { ethDecimal, numberTo0xHex } from '../lib/esm/utils.js';

// TODO: is it reasonable to leave that in tests?
const NODE_URL = 'https://nodes.mewapi.io/rpc/eth';
const NODE_HEADERS = { Origin: 'https://www.myetherwallet.com' };
// NOTE: most tests check for specific values and will fail because of price changes
const REAL_NETWORK = false;

const getKey = (url, opt) => {
  const _opt = { ...opt, headers: { ...opt.headers } };
  // Hide real node url/keys in test logs
  for (const k in NODE_HEADERS) delete _opt.headers[k];
  url = 'https://NODE_URL/';
  return JSON.stringify({ url, opt: _opt });
};

const fetchLogger = () => {
  const logs = {};
  const ftch = async (url, opt) => {
    const res = await fetch(url, opt);
    return {
      json: async () => {
        const json = await res.json();
        const key = getKey(url, opt);
        logs[key] = JSON.stringify(json);
        return json;
      },
    };
  };
  ftch.logs = logs;
  return ftch;
};

const fetchReplay = (logs) => {
  return (url, opt) => {
    const key = getKey(url, opt);
    if (!logs[key]) throw new Error(`fetchReplay: unknown request=${key}`);
    return { json: () => JSON.parse(logs[key]) };
  };
};

// FetchProvider(fetch) -> do network request
// FetchProvider(fetchLogger()) -> log request to replay
// FetchPRovider(fetchReplay(logs)) -> replay recorded logs

describe('Network', () => {
  should('ENS', async () => {
    const replay = fetchReplay({
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e\\",\\"data\\":\\"0x0178b8bfee6c4522aab0003e8d14cd40a6af439055fd2577951148c14b6cea9a53475835\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000004976fb03c32e5b8cfe2b6ccb31c09ba78ebaba41"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0x4976fb03c32e5b8cfe2b6ccb31c09ba78ebaba41\\",\\"data\\":\\"0x3b3b57deee6c4522aab0003e8d14cd40a6af439055fd2577951148c14b6cea9a53475835\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa96045"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e\\",\\"data\\":\\"0x0178b8bf7aef81fbd30c83431369026d62ee533af8b69f246b63d75b40fe223346e6fa9a\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000005fbb459c49bb06083c33109fa4f14810ec2cf358"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0x5fbb459c49bb06083c33109fa4f14810ec2cf358\\",\\"data\\":\\"0x691f34317aef81fbd30c83431369026d62ee533af8b69f246b63d75b40fe223346e6fa9a\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000b766974616c696b2e657468000000000000000000000000000000000000000000"}',
    });

    const logger = fetchLogger();
    const provider = FetchProvider(REAL_NETWORK ? fetch : replay, NODE_URL, NODE_HEADERS);
    const ens = new ENS(provider);
    const vitalikAddr = await ens.nameToAddress('vitalik.eth');
    const vitalikName = await ens.addressToName(vitalikAddr);
    //    console.log('LOGS', logger.logs);
    deepStrictEqual(vitalikAddr, '0xd8da6bf26964af9d7eed9e03e53415d37aa96045');
    deepStrictEqual(vitalikName, 'vitalik.eth');
  });
  should('Chainlink', async () => {
    const replay = fetchReplay({
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xf4030086522a5beea4988f8ca5b36dbc97bee88c\\",\\"data\\":\\"0xfeaf968c\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x00000000000000000000000000000000000000000000000600000000000030e40000000000000000000000000000000000000000000000000000064f201292180000000000000000000000000000000000000000000000000000000065ee021b0000000000000000000000000000000000000000000000000000000065ee021b00000000000000000000000000000000000000000000000600000000000030e4"}',
    });
    const logger = fetchLogger();
    const provider = FetchProvider(REAL_NETWORK ? fetch : replay, NODE_URL, NODE_HEADERS);
    const chainlink = new Chainlink(provider);
    const btcPrice = await chainlink.coinPrice('BTC');
    deepStrictEqual(btcPrice, 69369.10271);
    //console.log('LOGS', logger.logs);
  });

  should('UniswapV3', async () => {
    const replay = fetchReplay({
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x000000000000000000000000000000000000000000000102aed5731e0bb69839"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000001d6abcfd9cc27ed2"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000001d6abcfd9cc27ed2"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x000000000000000000000000000000000000000000000104238ab7cbe7174508"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000001d6abcfd9cc27ed2"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4dac17f958d2ee523a2206206994597c13d831ec70001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x000000000000000000000000000000000000000000000103fbcace2ec1edd013"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x000000000000000000000000000000000000000000000103b5c15d83c8d667ca"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000142b976bfa5d87c3eb"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000142b976bfa5d87c3eb"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8c00e94cb662c3520282e6f5717214004a7f268880027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8dac17f958d2ee523a2206206994597c13d831ec70027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4dac17f958d2ee523a2206206994597c13d831ec7000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000098df6cde7c10fd465"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4d46ba6d942050d489dbd938a2c909a5d5039a1610027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: TF","data":"0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000025446000000000000000000000000000000000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f42260fac5e5542a773aa44fbcfedf7c193bc2c5990027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000006d494d26ad203f81"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710dac17f958d2ee523a2206206994597c13d831ec7000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000098df6cde7c10fd465"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000142b976bfa5d87c3eb"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f42260fac5e5542a773aa44fbcfedf7c193bc2c599000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x000000000000000000000000000000000000000000000100f79a4f43a49f53ec"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8d46ba6d942050d489dbd938a2c909a5d5039a1610001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: TF","data":"0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000025446000000000000000000000000000000000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20027109f8f72aa9304c8b593d555f12ef6589cc3a579a20001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb89f8f72aa9304c8b593d555f12ef6589cc3a579a20027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8c00e94cb662c3520282e6f5717214004a7f26888000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x00000000000000000000000000000000000000000000000068fe473415e9de69"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710c00e94cb662c3520282e6f5717214004a7f26888000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x00000000000000000000000000000000000000000000000068fe473415e9de69"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4c00e94cb662c3520282e6f5717214004a7f26888000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710dac17f958d2ee523a2206206994597c13d831ec70027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710d46ba6d942050d489dbd938a2c909a5d5039a1610001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710dac17f958d2ee523a2206206994597c13d831ec70001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000ea7b2247311860570f"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8d46ba6d942050d489dbd938a2c909a5d5039a1610027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: TF","data":"0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000025446000000000000000000000000000000000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4dac17f958d2ee523a2206206994597c13d831ec70027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710c00e94cb662c3520282e6f5717214004a7f268880027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4d46ba6d942050d489dbd938a2c909a5d5039a1610001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: TF","data":"0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000025446000000000000000000000000000000000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4c00e94cb662c3520282e6f5717214004a7f268880001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb82260fac5e5542a773aa44fbcfedf7c193bc2c5990027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000006d494d26ad203f81"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4d46ba6d942050d489dbd938a2c909a5d5039a161000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: TF","data":"0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000025446000000000000000000000000000000000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8dac17f958d2ee523a2206206994597c13d831ec70001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x00000000000000000000000000000000000000000000010396379405dfd182d2"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb89f8f72aa9304c8b593d555f12ef6589cc3a579a2000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000b5a2b4aa9638226e79"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb82260fac5e5542a773aa44fbcfedf7c193bc2c599000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000001004411c7691c328823"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20027102260fac5e5542a773aa44fbcfedf7c193bc2c5990027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000006d494d26ad203f81"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710d46ba6d942050d489dbd938a2c909a5d5039a1610027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8dac17f958d2ee523a2206206994597c13d831ec7000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000098df6cde7c10fd465"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb89f8f72aa9304c8b593d555f12ef6589cc3a579a20001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20027102260fac5e5542a773aa44fbcfedf7c193bc2c599000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000ffb1ab93a6f0faf3e6"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f49f8f72aa9304c8b593d555f12ef6589cc3a579a2000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000020a39c195efc26fe3"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20027102260fac5e5542a773aa44fbcfedf7c193bc2c5990001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710c00e94cb662c3520282e6f5717214004a7f268880001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f49f8f72aa9304c8b593d555f12ef6589cc3a579a20001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f49f8f72aa9304c8b593d555f12ef6589cc3a579a20027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f42260fac5e5542a773aa44fbcfedf7c193bc2c5990001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8d46ba6d942050d489dbd938a2c909a5d5039a161000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: TF","data":"0x08c379a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000025446000000000000000000000000000000000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4c00e94cb662c3520282e6f5717214004a7f268880027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20027109f8f72aa9304c8b593d555f12ef6589cc3a579a20027106b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20027109f8f72aa9304c8b593d555f12ef6589cc3a579a2000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x0000000000000000000000000000000000000000000000b5437a99f21414fa99"}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8c00e94cb662c3520282e6f5717214004a7f268880001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":-32000,"message":"execution reverted"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2002710d46ba6d942050d489dbd938a2c909a5d5039a161000bb86b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_call\\",\\"params\\":[{\\"to\\":\\"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\\",\\"data\\":\\"0xcdca175300000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001111d67bb1bb00000000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb82260fac5e5542a773aa44fbcfedf7c193bc2c5990001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"error":{"code":3,"message":"execution reverted: Unexpected error","data":"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010556e6578706563746564206572726f7200000000000000000000000000000000"}}',
    });
    const logger = fetchLogger();
    const provider = FetchProvider(REAL_NETWORK ? fetch : replay, NODE_URL, NODE_HEADERS);
    const univ3 = new UniswapV3(provider);
    // Actual code
    const vitalikAddr = '0xd8da6bf26964af9d7eed9e03e53415d37aa96045';
    const DAI = tokenFromSymbol('DAI');
    // Swap 1.23 eth into DAI
    const swap = await univ3.swap('eth', DAI, '1.23', {
      // NOTE: we need to force deadline here, otherwise test will change deadline with every second passed
      deadline: 1720000000000,
    });
    deepStrictEqual(swap.expectedAmount, '4798.71452058898027444');
    const tx = await swap.tx(vitalikAddr, vitalikAddr); // same addr
    deepStrictEqual(tx, {
      amount: '1.23',
      address: '0xe592427a0aece92de3edee1f18e0157c05861564',
      expectedAmount: '4798.71452058898027444',
      data: '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa960450000000000000000000000000000000000000000000000000000019077fd30000000000000000000000000000000000000000000000000001111d67bb1bb0000000000000000000000000000000000000000000000000102d6906ca33403f40b0000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000',
      allowance: undefined,
    });
    //console.log('LOGS', logger.logs);
  });

  should('estimateGas', async () => {
    const replay = fetchReplay({
      '{"url":"https://NODE_URL/","opt":{"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"jsonrpc\\":\\"2.0\\",\\"id\\":0,\\"method\\":\\"eth_estimateGas\\",\\"params\\":[{\\"from\\":\\"0xd8da6bf26964af9d7eed9e03e53415d37aa96045\\",\\"to\\":\\"0xe592427a0aece92de3edee1f18e0157c05861564\\",\\"value\\":\\"0x1111d67bb1bb0000\\",\\"data\\":\\"0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa960450000000000000000000000000000000000000000000000000000019077fd30000000000000000000000000000000000000000000000000001111d67bb1bb0000000000000000000000000000000000000000000000000102d6906ca33403f40b0000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000\\"},\\"latest\\"]}"}}':
        '{"jsonrpc":"2.0","id":0,"result":"0x39a32"}',
    });
    const logger = fetchLogger();
    const provider = FetchProvider(REAL_NETWORK ? fetch : replay, NODE_URL, NODE_HEADERS);
    const gasLimit = await provider.estimateGas({
      from: '0xd8da6bf26964af9d7eed9e03e53415d37aa96045',
      to: '0xe592427a0aece92de3edee1f18e0157c05861564',
      value: numberTo0xHex(ethDecimal.decode('1.23')),
      data: '0xc04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa960450000000000000000000000000000000000000000000000000000019077fd30000000000000000000000000000000000000000000000000001111d67bb1bb0000000000000000000000000000000000000000000000000102d6906ca33403f40b0000000000000000000000000000000000000000000000000000000000000042c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000',
    });
    deepStrictEqual(gasLimit, 236082n);
    //console.log('LOGS', logger.logs);
  });
});

// ESM is broken.
import url from 'node:url';
if (import.meta.url === url.pathToFileURL(process.argv[1]).href) {
  should.run();
}
